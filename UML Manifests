@startuml
!include <C4/C4_Container>

' Forces the layout to be vertical
LAYOUT_TOP_DOWN()

System_Boundary(c1, "Live Streaming Environment") {
    System(encoder1, "Encoder 1", "French Audio", "Encoder")
    System(encoder2, "Encoder 2", "Spanish Audio", "Encoder")
   
    System(panopto_platform, "Panopto Cloud", "Ingests RTMP & Delivers Webcast")
   
    ' Push flow downwards
    Rel_Down(encoder1, panopto_platform, "RTMP Stream")
    Rel_Down(encoder2, panopto_platform, "RTMP Stream")
}

System_Boundary(c2, "Web Page") {
    System(web_server, "Web Server", "Hosts HTML, JS & Session GUIDs")
   
    System(panopto_player, "Panopto Iframe", "Embed.aspx Wrapper")
   
    ' Logical connection within the boundary
    Rel_Right(web_server, panopto_player, "Updates 'src' via JS")
}

Person_Ext(viewer, "Viewer", "Watches Live Event")

' Connect the major blocks vertically
Rel_Down(panopto_platform, panopto_player, "Delivers HLS Stream")
Rel_Up(viewer, panopto_player, "Selects Language", "UI Interaction")


@enduml

--

Alternative "Single-Input / Multi-Output Signal Flow"

@startuml
skinparam componentStyle uml2
skinparam monochrome true
skinparam linetype ortho
skinparam shadowing false
skinparam nodesep 80
skinparam ranksep 60
left to right direction

title Single-Input / Multi-Output Signal Flow

package "Production Gallery" {
    [SDI Source] as SDI
    note bottom of SDI : Video + Embedded Audio\n(Ch1-2: ENG, Ch3-4: ESP)
    
    component "AWS Elemental Live" as Encoder
}

package "Panopto Cloud" {
    [Session: English] as CloudEN
    [Session: Spanish] as CloudES
    
    ' Force Vertical Layout (English above Spanish)
    CloudEN -[hidden]- CloudES
}

package "Client Browser" {
    [HTML Wrapper] as Logic
    [Player Iframe] as Player
}

' 1. Input Flow
SDI --> Encoder

' 2. Fan-Out Flow (Encoder to Cloud)
Encoder --> CloudEN : Extract Pair 1\n(RTMP Stream A)
Encoder --> CloudES : Extract Pair 2\n(RTMP Stream B)

' 3. Delivery Flow (Cloud to Player)
CloudEN --> Player : HLS
CloudES --> Player : HLS

' 4. Control Logic (Wrapper to Player)
Logic ..> Player : Inject GUID

@enduml

--

Alternative "Single-Input / Multi-Output Signal Flow" #2

@startuml
!include <C4/C4_Container>

' Forces the layout to be vertical as requested
LAYOUT_TOP_DOWN()

System_Boundary(c1, "Production & Distribution Environment") {
    
    ' Updated: Single Hardware Appliance instead of multiple encoders
    Container(elemental, "AWS Elemental Live", "Hardware Appliance", "Ingests 1x SDI Source. Splits Audio Pairs to Output Groups.")
    
    System(panopto_platform, "Panopto Cloud", "Ingests RTMP & Delivers Webcast")
    
    ' Visualising the Fan-Out: One Box, Two Streams
    Rel_Down(elemental, panopto_platform, "RTMP Stream A (English)")
    Rel_Down(elemental, panopto_platform, "RTMP Stream B (Spanish)")
}

System_Boundary(c2, "Client Endpoint (Browser)") {
    Container(web_logic, "Switcher Logic", "HTML/JS", "Detects Locale & Maps to GUID")
    
    Container(panopto_player, "Panopto Iframe", "Embed.aspx Wrapper", "Renders the Video")
    
    ' Logical connection within the boundary
    Rel_Right(web_logic, panopto_player, "Updates 'src' attribute")
}

Person_Ext(viewer, "Viewer", "Watches Live Event")

' Connect the major blocks vertically
Rel_Down(panopto_platform, panopto_player, "Delivers HLS Stream")
Rel_Up(viewer, web_logic, "Selects Language", "UI Interaction")

@enduml
